<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radio Only Haswer</title>
<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:Arial;text-align:center;overflow-x:hidden;}
.bg{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 20%, #1f1f1f, #000);animation:bgmove 12s infinite alternate;z-index:-1;}
@keyframes bgmove{0%{background-position:0 0}100%{background-position:100px 200px}}
header{padding:25px;font-size:32px;font-weight:bold;background:#111;box-shadow:0 2px 20px #000;letter-spacing:1px;}
nav{margin-top:10px;display:flex;justify-content:center;gap:20px;}
nav a{color:#4ade80;font-size:18px;cursor:pointer;text-decoration:none;padding:8px 14px;border-radius:8px;transition:.2s;}
nav a:hover{background:#222;}
.section{display:none;padding:25px;animation:fade .4s;}
@keyframes fade{from{opacity:0}to{opacity:1}}
.player{max-width:450px;margin:20px auto;background:#1b1b1b;padding:25px;border-radius:18px;box-shadow:0 0 20px #000;}
audio{width:100%;margin-top:15px;}
#viz{width:100%;height:80px;margin-top:15px;background:linear-gradient(to right,#333,#111);border-radius:10px;}
.meta{margin-top:15px;color:#4ade80;font-size:18px;}
.social{margin-top:20px;display:flex;justify-content:center;gap:20px;}
.social a{color:#fff;font-size:24px;text-decoration:none;}
footer{margin:40px 0;color:#777;font-size:14px;}
.chatbox{display:flex;justify-content:center;margin-top:20px;}
</style>
</head>
<body>

<div class="bg"></div>
<header>ğŸ“» Radio Only Haswer</header>
<nav>
<a onclick="show('radio')">Radio</a>
<a onclick="show('chat')">Chat</a>
<a onclick="show('info')">Info</a>
</nav>

<div id="radio" class="section" style="display:block">
Â  <div class="player">
Â  Â  <img src="https://cdn-icons-png.flaticon.com/512/727/727245.png" width="90" alt="logo">
Â  Â  <audio id="audio" controls></audio>
Â  Â  <canvas id="viz"></canvas>
Â  Â  <div id="meta" class="meta">Cargando metadata...</div>
Â  Â  <div id="listeners" style="margin-top:8px;color:#aaa;font-size:14px"></div>
Â  Â  <div class="social">
Â  Â  Â  <a href="#">ğŸŒ</a>
Â  Â  Â  <a href="#">ğŸ“˜</a>
Â  Â  Â  <a href="#">â–¶ï¸</a>
Â  Â  Â  <a href="#">ğŸ“¸</a>
Â  Â  </div>
Â  </div>
</div>

<div id="chat" class="section">
Â  <div class="section-title">ğŸ’¬ Chat en vivo</div>
Â  <div class="chatbox">
Â  Â  <iframe src="https://xat.com/embed/chat.php#id=5&gn=OnlyHaswerRadio"
Â  Â  Â  Â  Â  Â  width="900" height="600"></iframe>
Â  </div>
</div>

<div id="info" class="section">
<h2>â„¹ï¸ InformaciÃ³n</h2>
<p>Radio Only Haswer â€” Transmitiendo 24/7 con Icecast + BUTT.</p>
<p>VersiÃ³n completa del sitio con player, visualizador, chat, tabs y estilo oscuro.</p>
</div>

<footer>Radio Only Haswer â€” GitHub Pages</footer>

<script>
function show(id){
Â  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
Â  document.getElementById(id).style.display='block';
}

// **CAMBIO IMPORTANTE: Usar la URL base de ngrok sin el proxy para la URL del stream de audio.**
// El elemento <audio> es mÃ¡s permisivo con CORS para streams directos.
// Mantener esta URL actualizada es CRÃTICO cada vez que reinicies ngrok, a menos que uses un dominio fijo.
const NGROK_BASE_URL = "https://oblanceolate-preapply-oneida.ngrok-free.dev";

// **OPCIÃ“N A: Audio directo (Recomendado para ngrok + stream)**
// El navegador deberÃ­a ser capaz de reproducir el stream si ngrok funciona correctamente.
const audio = document.getElementById("audio");
audio.src = NGROK_BASE_URL + "/radio.mp3";
audio.play().catch(()=>{});

// **OPCIÃ“N B: Audio por proxy (si la OpciÃ³n A falla)**
// audio.src = "https://corsproxy.io/?" + encodeURIComponent(NGROK_BASE_URL + "/radio.mp3");
// audio.play().catch(()=>{});


// **CAMBIO IMPORTANTE: Metadatos con un proxy mÃ¡s robusto o directo si es posible**
// `corsproxy.io` a veces puede fallar para JSON. Usaremos la misma lÃ³gica de proxy,
// pero si tienes problemas, considera cambiar a un proxy de tu propiedad.
// La URL completa para la peticiÃ³n de metadatos DEBE ir en el parÃ¡metro del proxy.
const metaUrl = "https://corsproxy.io/?" + encodeURIComponent(NGROK_BASE_URL + "/status-json.xsl");

// Visualizador (sin cambios)
const ctx = new (window.AudioContext || window.webkitAudioContext)();
// Se necesita que el audio inicie una vez que el usuario interactÃºa con la pÃ¡gina
// Por eso, la conexiÃ³n al visualizador se harÃ¡ dentro de la funciÃ³n de manejo de reproducciÃ³n.
let src; 
let analyser;

function setupVisualizer() {
    if (!src) { // Configurar solo la primera vez
        src = ctx.createMediaElementSource(audio);
        analyser = ctx.createAnalyser();
        src.connect(analyser);
        analyser.connect(ctx.destination);
        analyser.fftSize = 256;
        drawViz(); // Iniciar el dibujo despuÃ©s de la configuraciÃ³n
    }
}

// Escuchar el evento de reproducciÃ³n para configurar el visualizador
// Esto ayuda con la polÃ­tica de autoplay del navegador (que requiere interacciÃ³n)
audio.addEventListener('play', setupVisualizer, { once: true });


const buffer = new Uint8Array(analyser ? analyser.frequencyBinCount : 0); // InicializaciÃ³n segura
const canvas = document.getElementById("viz");
const c = canvas.getContext("2d");

function drawViz(){
Â  requestAnimationFrame(drawViz);
Â  if (!analyser) return; // Salir si el analizador no estÃ¡ configurado

Â  analyser.getByteFrequencyData(buffer);
Â  c.fillStyle="#111";
Â  c.fillRect(0,0,canvas.width,canvas.height);
Â  let barWidth=canvas.width/buffer.length;
Â  for(let i=0;i<buffer.length;i++){
Â  Â  const h=buffer[i];
Â  Â  c.fillStyle="#4ade80";
Â  Â  c.fillRect(i*barWidth,canvas.height-h,barWidth-1,h);
Â  }
}
canvas.width=450;
// No llamar a drawViz aquÃ­, se llama dentro de setupVisualizer cuando el usuario interactÃºa.

// Metadata en vivo (sin cambios mayores en la lÃ³gica, solo para asegurar el async/await)
async function loadMeta(){
Â  try{
Â  Â  // Usa fetch para la URL del proxy de metadatos
Â  Â  const r = await fetch(metaUrl);
Â  Â  if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);

Â  Â  const j = await r.json();
Â  Â  
Â  Â  let srcData = j.icestats.source;

    // Asegurar que 'srcData' es un objeto si solo hay una fuente.
Â  Â  if(Array.isArray(srcData)) {
        // Busca la fuente correcta, que debe ser la que tiene "/radio.mp3"
        srcData = srcData.find(s=>s.listenurl && s.listenurl.includes("radio.mp3"));
    }
    
    // Si la fuente no se encuentra, usar un objeto vacÃ­o para evitar errores
    if(!srcData) srcData = {}; 

    // Revisa si 'title' existe y actualiza el texto
Â  Â  document.getElementById("meta").innerText="â–¶ "+(srcData.title||"Sin metadata");
Â  Â  document.getElementById("listeners").innerText="ğŸ‘¥ Oyentes: "+(srcData.listeners||0);

Â  }catch(e){
    console.error("Error al cargar metadata:", e);
Â  Â  document.getElementById("meta").innerText="Metadata no disponible (Error)";
Â  Â  document.getElementById("listeners").innerText="Revisar tÃºnel ngrok/CORS";
Â  }
}
loadMeta();
setInterval(loadMeta,10000);
</script>

</body>
</html>




